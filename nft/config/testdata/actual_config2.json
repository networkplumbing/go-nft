{
  "nftables": [
    {
      "metainfo": {
        "json_schema_version": 1,
        "release_name": "Lester Gooch",
        "version": "1.0.2"
      }
    },
    {
      "table": {
        "family": "inet",
        "handle": 16,
        "name": "filter"
      }
    },
    {
      "chain": {
        "family": "inet",
        "handle": 1,
        "hook": "input",
        "name": "input",
        "policy": "accept",
        "prio": 0,
        "table": "filter",
        "type": "filter"
      },
      "counter": {
        "bytes": 0,
        "family": "inet",
        "handle": 3,
        "name": "drop_ct_invalid",
        "packets": 0,
        "table": "filter"
      }
    },
    {
      "counter": {
        "bytes": 0,
        "family": "inet",
        "handle": 4,
        "name": "drop_input",
        "packets": 0,
        "table": "filter"
      },
      "rule": {
        "chain": "input",
        "expr": [
          {
            "match": {
              "left": {
                "payload": {
                  "field": "dport",
                  "protocol": "tcp"
                }
              },
              "op": "==",
              "right": 22
            }
          },
          {
            "counter": {
              "bytes": 321462450,
              "packets": 2829683
            }
          }
        ],
        "family": "inet",
        "handle": 4,
        "table": "filter"
      }
    },
    {
      "counter": {
        "bytes": 0,
        "family": "inet",
        "handle": 5,
        "name": "drop_forward",
        "packets": 0,
        "table": "filter"
      },
      "rule": {
        "chain": "input",
        "expr": [
          {
            "counter": {
              "bytes": 14008044351,
              "packets": 17237631
            }
          }
        ],
        "family": "inet",
        "handle": 5,
        "table": "filter"
      }
    },
    {
      "counter": {
        "bytes": 0,
        "family": "inet",
        "handle": 6,
        "name": "drop_ssh",
        "packets": 0,
        "table": "filter"
      },
      "rule": {
        "chain": "input",
        "expr": [
          {
            "counter": {
              "bytes": 14008031490,
              "packets": 17237500
            }
          }
        ],
        "family": "inet",
        "handle": 6,
        "table": "filter"
      }
    },
    {
      "counter": {
        "bytes": 4552158913,
        "family": "inet",
        "handle": 7,
        "name": "accept_ct_rel",
        "packets": 20203437,
        "table": "filter"
      },
      "rule": {
        "chain": "input",
        "expr": [
          {
            "match": {
              "left": {
                "payload": {
                  "field": "dport",
                  "protocol": "tcp"
                }
              },
              "op": "==",
              "right": {
                "set": [
                  22,
                  4022,
                  44022
                ]
              }
            }
          },
          {
            "counter": {
              "bytes": 268021315,
              "packets": 2383090
            }
          }
        ],
        "family": "inet",
        "handle": 9,
        "table": "filter"
      }
    },
    {
      "counter": {
        "bytes": 0,
        "family": "inet",
        "handle": 8,
        "name": "accept_https",
        "packets": 0,
        "table": "filter"
      },
      "rule": {
        "chain": "input",
        "expr": [
          {
            "match": {
              "left": {
                "payload": {
                  "field": "dport",
                  "protocol": "tcp"
                }
              },
              "op": "==",
              "right": {
                "set": [
                  22,
                  4022,
                  {
                    "range": [
                      44000,
                      44022
                    ]
                  }
                ]
              }
            }
          },
          {
            "counter": {
              "bytes": 268010111,
              "packets": 2382881
            }
          }
        ],
        "family": "inet",
        "handle": 11,
        "table": "filter"
      }
    },
    {
      "counter": {
        "bytes": 0,
        "family": "inet",
        "handle": 9,
        "name": "accept_ssh",
        "packets": 0,
        "table": "filter"
      },
      "rule": {
        "chain": "input",
        "expr": [
          {
            "match": {
              "left": {
                "meta": {
                  "key": "iifname"
                }
              },
              "op": "==",
              "right": "enp2s0f2"
            }
          },
          {
            "match": {
              "left": {
                "payload": {
                  "field": "dport",
                  "protocol": "tcp"
                }
              },
              "op": "==",
              "right": {
                "set": [
                  22,
                  2181,
                  2888,
                  3888,
                  {
                    "range": [
                      9000,
                      10000
                    ]
                  },
                  30041,
                  {
                    "range": [
                      30242,
                      30260
                    ]
                  },
                  {
                    "range": [
                      30441,
                      30456
                    ]
                  }
                ]
              }
            }
          },
          {
            "counter": {
              "bytes": 0,
              "packets": 0
            }
          }
        ],
        "family": "inet",
        "handle": 13,
        "table": "filter"
      }
    },
    {
      "chain": {
        "family": "inet",
        "handle": 2,
        "hook": "forward",
        "name": "forward",
        "policy": "accept",
        "prio": 0,
        "table": "filter",
        "type": "filter"
      },
      "counter": {
        "bytes": 180,
        "family": "inet",
        "handle": 10,
        "name": "accept_wg",
        "packets": 3,
        "table": "filter"
      }
    },
    {
      "chain": {
        "family": "inet",
        "handle": 3,
        "hook": "output",
        "name": "output",
        "policy": "accept",
        "prio": 0,
        "table": "filter",
        "type": "filter"
      },
      "counter": {
        "bytes": 0,
        "family": "inet",
        "handle": 11,
        "name": "accept_telemetry",
        "packets": 0,
        "table": "filter"
      }
    },
    {
      "counter": {
        "bytes": 0,
        "family": "inet",
        "handle": 12,
        "name": "accept_icmp_echo",
        "packets": 0,
        "table": "filter"
      }
    },
    {
      "counter": {
        "bytes": 0,
        "family": "inet",
        "handle": 13,
        "name": "accept_scion",
        "packets": 0,
        "table": "filter"
      }
    },
    {
      "chain": {
        "family": "inet",
        "handle": 1,
        "hook": "input",
        "name": "input",
        "policy": "drop",
        "prio": 0,
        "table": "filter",
        "type": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "expr": [
          {
            "match": {
              "left": {
                "payload": {
                  "field": "dport",
                  "protocol": "tcp"
                }
              },
              "op": "==",
              "right": 22
            }
          },
          {
            "match": {
              "left": {
                "payload": {
                  "field": "saddr",
                  "protocol": "ip"
                }
              },
              "op": "!=",
              "right": {
                "set": [
                  {
                    "prefix": {
                      "addr": "10.253.61.72",
                      "len": 29
                    }
                  },
                  "10.148.116.135",
                  "198.247.170.90",
                  "198.247.170.170",
                  {
                    "prefix": {
                      "addr": "198.18.0.0",
                      "len": 24
                    }
                  }
                ]
              }
            }
          },
          {
            "counter": "drop_ssh"
          },
          {
            "drop": null
          }
        ],
        "family": "inet",
        "handle": 16,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "comment": "drop ct invalid",
        "expr": [
          {
            "match": {
              "left": {
                "ct": {
                  "key": "state"
                }
              },
              "op": "in",
              "right": "invalid"
            }
          },
          {
            "counter": "drop_ct_invalid"
          },
          {
            "drop": null
          }
        ],
        "family": "inet",
        "handle": 17,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "comment": "Connection initated by host",
        "expr": [
          {
            "match": {
              "left": {
                "ct": {
                  "key": "state"
                }
              },
              "op": "in",
              "right": [
                "established",
                "related"
              ]
            }
          },
          {
            "counter": "accept_ct_rel"
          },
          {
            "accept": null
          }
        ],
        "family": "inet",
        "handle": 18,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "expr": [
          {
            "match": {
              "left": {
                "meta": {
                  "key": "iif"
                }
              },
              "op": "==",
              "right": "lo"
            }
          },
          {
            "accept": null
          }
        ],
        "family": "inet",
        "handle": 19,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "expr": [
          {
            "match": {
              "left": {
                "meta": {
                  "key": "iif"
                }
              },
              "op": "==",
              "right": "wg0"
            }
          },
          {
            "counter": "accept_wg"
          },
          {
            "accept": null
          }
        ],
        "family": "inet",
        "handle": 20,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "expr": [
          {
            "match": {
              "left": {
                "meta": {
                  "key": "iif"
                }
              },
              "op": "==",
              "right": "wg1"
            }
          },
          {
            "counter": "accept_wg"
          },
          {
            "accept": null
          }
        ],
        "family": "inet",
        "handle": 21,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "comment": "Appliance API access",
        "expr": [
          {
            "match": {
              "left": {
                "payload": {
                  "field": "daddr",
                  "protocol": "ip"
                }
              },
              "op": "==",
              "right": "198.18.3.11"
            }
          },
          {
            "match": {
              "left": {
                "payload": {
                  "field": "dport",
                  "protocol": "tcp"
                }
              },
              "op": "==",
              "right": 443
            }
          },
          {
            "counter": "accept_https"
          },
          {
            "accept": null
          }
        ],
        "family": "inet",
        "handle": 22,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "comment": "Appliance telemetry access",
        "expr": [
          {
            "match": {
              "left": {
                "payload": {
                  "field": "dport",
                  "protocol": "tcp"
                }
              },
              "op": "==",
              "right": 42001
            }
          },
          {
            "counter": "accept_telemetry"
          },
          {
            "accept": null
          }
        ],
        "family": "inet",
        "handle": 23,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "comment": "SSH connections",
        "expr": [
          {
            "match": {
              "left": {
                "payload": {
                  "field": "dport",
                  "protocol": "tcp"
                }
              },
              "op": "==",
              "right": 22
            }
          },
          {
            "counter": "accept_ssh"
          },
          {
            "accept": null
          }
        ],
        "family": "inet",
        "handle": 24,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "comment": "SCION interfaces",
        "expr": [
          {
            "match": {
              "left": {
                "payload": {
                  "field": "daddr",
                  "protocol": "ip"
                }
              },
              "op": "==",
              "right": "10.193.61.62"
            }
          },
          {
            "match": {
              "left": {
                "payload": {
                  "field": "saddr",
                  "protocol": "ip"
                }
              },
              "op": "==",
              "right": "193.247.170.170"
            }
          },
          {
            "match": {
              "left": {
                "payload": {
                  "field": "sport",
                  "protocol": "udp"
                }
              },
              "op": "==",
              "right": 30050
            }
          },
          {
            "match": {
              "left": {
                "payload": {
                  "field": "dport",
                  "protocol": "udp"
                }
              },
              "op": "==",
              "right": 31000
            }
          },
          {
            "counter": "accept_scion"
          },
          {
            "accept": null
          }
        ],
        "family": "inet",
        "handle": 25,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "comment": "SCION interfaces",
        "expr": [
          {
            "match": {
              "left": {
                "payload": {
                  "field": "daddr",
                  "protocol": "ip"
                }
              },
              "op": "==",
              "right": "10.193.61.62"
            }
          },
          {
            "match": {
              "left": {
                "payload": {
                  "field": "saddr",
                  "protocol": "ip"
                }
              },
              "op": "==",
              "right": "10.247.170.90"
            }
          },
          {
            "match": {
              "left": {
                "payload": {
                  "field": "sport",
                  "protocol": "udp"
                }
              },
              "op": "==",
              "right": 31003
            }
          },
          {
            "match": {
              "left": {
                "payload": {
                  "field": "dport",
                  "protocol": "udp"
                }
              },
              "op": "==",
              "right": 31001
            }
          },
          {
            "counter": "accept_scion"
          },
          {
            "accept": null
          }
        ],
        "family": "inet",
        "handle": 26,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "comment": "Dispatcher",
        "expr": [
          {
            "match": {
              "left": {
                "payload": {
                  "field": "daddr",
                  "protocol": "ip"
                }
              },
              "op": "==",
              "right": "10.0.0.1"
            }
          },
          {
            "match": {
              "left": {
                "payload": {
                  "field": "dport",
                  "protocol": "udp"
                }
              },
              "op": "==",
              "right": 30041
            }
          },
          {
            "counter": "accept_scion"
          },
          {
            "accept": null
          }
        ],
        "family": "inet",
        "handle": 27,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "expr": [
          {
            "match": {
              "left": {
                "payload": {
                  "field": "type",
                  "protocol": "icmpv6"
                }
              },
              "op": "==",
              "right": {
                "set": [
                  "nd-router-advert",
                  "nd-neighbor-solicit",
                  "nd-neighbor-advert"
                ]
              }
            }
          },
          {
            "accept": null
          }
        ],
        "family": "inet",
        "handle": 28,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "expr": [
          {
            "match": {
              "left": {
                "payload": {
                  "field": "type",
                  "protocol": "icmpv6"
                }
              },
              "op": "==",
              "right": "echo-request"
            }
          },
          {
            "counter": "accept_icmp_echo"
          },
          {
            "accept": null
          }
        ],
        "family": "inet",
        "handle": 29,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "expr": [
          {
            "match": {
              "left": {
                "payload": {
                  "field": "type",
                  "protocol": "icmp"
                }
              },
              "op": "==",
              "right": "echo-request"
            }
          },
          {
            "counter": "accept_icmp_echo"
          },
          {
            "accept": null
          }
        ],
        "family": "inet",
        "handle": 30,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "input",
        "comment": "Dropped input traffic",
        "expr": [
          {
            "counter": "drop_input"
          }
        ],
        "family": "inet",
        "handle": 31,
        "table": "filter"
      }
    },
    {
      "chain": {
        "family": "inet",
        "handle": 2,
        "hook": "forward",
        "name": "forward",
        "policy": "drop",
        "prio": 0,
        "table": "filter",
        "type": "filter"
      }
    },
    {
      "rule": {
        "chain": "forward",
        "comment": "Connection initiated by us",
        "expr": [
          {
            "match": {
              "left": {
                "ct": {
                  "key": "state"
                }
              },
              "op": "in",
              "right": [
                "established",
                "related"
              ]
            }
          },
          {
            "counter": "accept_ct_rel"
          },
          {
            "accept": null
          }
        ],
        "family": "inet",
        "handle": 32,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "forward",
        "comment": "Linux interface for router",
        "expr": [
          {
            "match": {
              "left": {
                "meta": {
                  "key": "iifname"
                }
              },
              "op": "==",
              "right": "enp2s0f2"
            }
          },
          {
            "accept": null
          }
        ],
        "family": "inet",
        "handle": 33,
        "table": "filter"
      }
    },
    {
      "rule": {
        "chain": "forward",
        "comment": "Dropped forward traffic",
        "expr": [
          {
            "counter": "drop_forward"
          }
        ],
        "family": "inet",
        "handle": 34,
        "table": "filter"
      }
    }
  ]
}